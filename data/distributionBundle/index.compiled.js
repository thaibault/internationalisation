'use strict';
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jQuery-tools"),require("jquery")):"function"==typeof define&&define.amd?define("jQuery-lang",["jQuery-tools","jquery"],t):"object"==typeof exports?exports["jQuery-lang"]=t(require("jQuery-tools"),require("jquery")):e["jQuery-lang"]=t(e["jQuery-tools"],e.jquery)}(this,function(e,t){return function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){(function(e,t){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(4),u=o(s);n(3);var l=function(){return"undefined"===u["default"].type(window)?"undefined"===u["default"].type(e)?"undefined"===u["default"].type(t)?{}:t:e:window}();!("document"in l)&&"context"in u["default"]&&(l.document=u["default"].context);var d=function(e){function t(){return a(this,t),r(this,e.apply(this,arguments))}return i(t,e),t.prototype.initialize=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=arguments.length<=3||void 0===arguments[3]?null:arguments[3],r=this,i=arguments.length<=4||void 0===arguments[4]?[]:arguments[4],s=arguments.length<=5||void 0===arguments[5]?{}:arguments[5];this.currentLanguage=n,this.knownTranslation=o,this._$domNodeToFade=a,this._replacements=i,this._textNodesWithKnownTranslation=s,this._options={domNodeSelectorPrefix:"body","default":"enUS",allowedLanguages:[],initial:null,templateDelimiter:{pre:"{{",post:"}}"},fadeEffect:!0,textNodeParent:{showAnimation:[{opacity:1},{duration:"fast"}],hideAnimation:[{opacity:0},{duration:"fast"}]},preReplacementLanguagePattern:"^\\|({1})$",replacementLanguagePattern:"^([a-z]{2}[A-Z]{2}):((.|\\s)*)$",currentLanguagePattern:"^[a-z]{2}[A-Z]{2}$",replacementDomNodeName:["#comment","langreplacement"],replaceDomNodeNames:["#text","langreplace"],toolsLockDescription:"{1}Switch",languageHashPrefix:"lang-",currentLanguageIndicatorClassName:"current",sessionDescription:"{1}",languageMapping:{deDE:["de","de_de","de-de","german","deutsch"],enUS:["en","en_us","en-us"],enEN:["en_en","en-en","english"],frFR:["fr","fr_fr","fr-fr","french"]},onSwitched:u["default"].noop(),onEnsured:u["default"].noop(),onSwitch:u["default"].noop(),onEnsure:u["default"].noop(),domNode:{knownTranslation:"div.toc"}},e.prototype.initialize.call(this,t),this._options.preReplacementLanguagePattern=this.constructor.stringFormat(this._options.preReplacementLanguagePattern,this._options.replacementLanguagePattern.substr(1,this._options.replacementLanguagePattern.length-2)),this._options.toolsLockDescription=this.constructor.stringFormat(this._options.toolsLockDescription,this.constructor._name),this._options.sessionDescription=this.constructor.stringFormat(this._options.sessionDescription,this.constructor._name),this.$domNodes=this.grabDomNode(this._options.domNode),this.$domNodes.switchLanguageButtons=(0,u["default"])('a[href^="#'+this._options.languageHashPrefix+'"]'),this._movePreReplacementNodes(),this.currentLanguage=this._normalizeLanguage(this._options["default"]);var l=this._determineUsefulLanguage();return this.on(this.$domNodes.switchLanguageButtons,"click",function(e){return e.preventDefault(),r["switch"]((0,u["default"])(e.target).attr("href").substr(r._options.languageHashPrefix.length+1))}),this.currentLanguage===l?u["default"].when(this._switchCurrentLanguageIndicator(l)):this["switch"](l,!0)},t.prototype["switch"]=function(e){var t=this,n=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];if(e!==!0&&this._options.allowedLanguages.length&&!this._options.allowedLanguages.includes(e))return this.debug('"{1}" isn\'t one of the allowed languages.',e),u["default"].when(this);var o=u["default"].Deferred();return this.acquireLock(this._options.toolsLockDescription,function(){if(e===!0?(n=!0,e=t.currentLanguage):e=t._normalizeLanguage(e),n&&e!==t._options["default"]||t.currentLanguage!==e){var a="Switch to";n&&(a="Ensure"),t.debug('{1} "{2}".',a,e),t._switchCurrentLanguageIndicator(e),t.fireEvent(n?"ensure":"switch",!0,t,t.currentLanguage,e),t._$domNodeToFade=null,t._replacements=[];var r=t._collectTextNodesToReplace(e,n),i=r[0],s=r[1];t._ensureLastTextNodeHavingLanguageIndicator(i,s,n),t._handleSwitchEffect(e,n).then(function(){return o.resolve(t)})}else t.debug('"{1}" is already current selected language.',e),t.releaseLock(t._options.toolsLockDescription),o.resolve(t)}),o},t.prototype.refresh=function(){return this._movePreReplacementNodes()["switch"](!0)},t.prototype._movePreReplacementNodes=function(){var e=this;return this.$domNodes.parent.find(":not(iframe)").contents().each(function(){var t=(0,u["default"])(this),n=t.prop("nodeName").toLowerCase();if(e._options.replacementDomNodeName.includes(n)){["#comment","#text"].includes(n)||t.hide();var o=new RegExp(e._options.preReplacementLanguagePattern),a=t.prop("textContent").match(o);a&&a[0]&&!function(){t.prop("textContent",t.prop("textContent").replace(o,a[1]));var e=!1;t.parent().contents().each(function(){return e&&(0,u["default"])(this).Tools("getText").trim()?(t.appendTo(this),!1):void(t[0]===this&&(e=!0))})}()}}),this},t.prototype._collectTextNodesToReplace=function(e,t){var n=null,o=null,a=null,r=null;this.knownTranslation={};var i=this;return this.$domNodes.parent.find(":not(iframe)").contents().each(function(){var s=(0,u["default"])(this),l=s.prop("nodeName").toLowerCase();if(i._options.replaceDomNodeNames.includes(l.toLowerCase()))s.Tools("getText").trim()&&0===s.parents(i._options.replaceDomNodeNames.join()).length&&(r=i._ensureLastTextNodeHavingLanguageIndicator(a,r,t),n=s);else if(n){if(i._options.replacementDomNodeName.includes(l)){var d=s.prop("textContent");"#comment"!==l&&(d=s.html());var p=d.match(new RegExp(i._options.replacementLanguagePattern));return Array.isArray(p)&&p[1]===e?(i.knownTranslation[n.Tools("getText").trim()]=p[2].trim(),i._registerTextNodeToChange(n,s,p,o),a=n,r=o,n=null,o=null):s.prop("textContent").match(new RegExp(i._options.currentLanguagePattern))&&(o=s),!0}a=null,r=null,n=null,o=null}}),this._registerKnownTextNodes(),[a,r]},t.prototype._registerKnownTextNodes=function(){this._textNodesWithKnownTranslation={};var e=this;return this.$domNodes.knownTranslation.find(":not(iframe)").contents().each(function(){var t=(0,u["default"])(this);!e._options.replaceDomNodeNames.includes(t.prop("nodeName").toLowerCase())&&t.Tools("getText").trim()&&0===t.parents(e._options.replaceDomNodeNames.join()).length&&e.knownTranslation.hasOwnProperty(t.Tools("getText").trim())&&(e._addTextNodeToFade(t),e._textNodesWithKnownTranslation.hasOwnProperty(e.knownTranslation[t.prop("textContent").trim()])?e._textNodesWithKnownTranslation[e.knownTranslation[t.prop("textContent").trim()]]=e._textNodesWithKnownTranslation[e.knownTranslation[t.prop("textContent").trim()]].add(t):e._textNodesWithKnownTranslation[e.knownTranslation[t.prop("textContent").trim()]]=t)}),this},t.prototype._normalizeLanguage=function(e){for(var t in this._options.languageMapping)if(this._options.languageMapping.hasOwnProperty(t)&&(this._options.languageMapping[t].includes(t.toLowerCase())||this._options.languageMapping[t].push(t.toLowerCase()),this._options.languageMapping[t].includes(e.toLowerCase())))return t;return this._options["default"]},t.prototype._determineUsefulLanguage=function(){var e=void 0;return this._options.initial?e=this._options.initial:"localStorage"in l&&l.localStorage.getItem(this._options.sessionDescription)?(e=l.localStorage.getItem(this._options.sessionDescription),this.debug('Determine "{1}", because of local storage information.',e)):"navigator"in l&&navigator.language?(e=navigator.language,this.debug('Determine "{1}", because of browser settings.',e)):(e=this._options["default"],this.debug('Determine "{1}", because of default option.',e)),e=this._normalizeLanguage(e),this._options.allowedLanguages.length&&!this._options.allowedLanguages.includes(e)&&(this.debug('"{1}" isn\'t one of the allowed languages. Set language to "{2}".',e,this._options.allowedLanguages[0]),e=this._options.allowedLanguages[0]),"localStorage"in l&&l.localStorage.setItem(this._options.sessionDescription,e),e},t.prototype._handleSwitchEffect=function(e,t){var n=this,o=this.currentLanguage;return!t&&this._options.fadeEffect&&this._$domNodeToFade?this._$domNodeToFade.animate.apply(this._$domNodeToFade,this._options.textNodeParent.hideAnimation).promise().then(function(){return n._switchLanguage(e),n._$domNodeToFade?n._$domNodeToFade.animate.apply(n._$domNodeToFade,n._options.textNodeParent.showAnimation).promise().then(function(){return n.fireEvent(t?"ensured":"switched",!0,n,o,e),n.releaseLock(n._options.toolsLockDescription),u["default"].when(n)}):u["default"].when(n)}):(this._switchLanguage(e),this.fireEvent(t?"ensured":"switched",!0,this,o,e),this.releaseLock(this._options.toolsLockDescription),u["default"].when(this))},t.prototype._addTextNodeToFade=function(e){var t=e.parent();return this._$domNodeToFade?this._$domNodeToFade=this._$domNodeToFade.add(t):this._$domNodeToFade=t,this},t.prototype._registerTextNodeToChange=function(e,t,n,o){return this._addTextNodeToFade(e),t&&this._replacements.push({$textNodeToTranslate:e,$nodeToReplace:t,textToReplace:n[2],$currentLanguageDomNode:o}),this},t.prototype._ensureLastTextNodeHavingLanguageIndicator=function(e,t,n){if(e&&!t){var o=this.currentLanguage;n&&(o=this._options["default"]),t=(0,u["default"])("<!--"+o+"-->"),e.after(t)}return t},t.prototype._switchLanguage=function(e){for(var t=this,n=function(){if(a){if(r>=o.length)return"break";i=o[r++]}else{if(r=o.next(),r.done)return"break";i=r.value}var n=i,s=n.$textNodeToTranslate.html();"#text"===n.$textNodeToTranslate.prop("nodeName")&&(s=n.$textNodeToTranslate.prop("textContent"));var l=s.trim();if(!t._options.templateDelimiter||!l.endsWith(t._options.templateDelimiter.post)&&t._options.templateDelimiter.post){var d=n.$currentLanguageDomNode;n.$currentLanguageDomNode||!function(){d=(0,u["default"])("body");var e=!1;n.$textNodeToTranslate.parent().contents().each(function(){return e?(n.$currentLanguageDomNode=d=(0,u["default"])(this),!1):void(this===n.$textNodeToTranslate[0]&&(e=!0))})}();var p=d.prop("textContent");e===p&&t.warn('Text node "'+n.textToReplace+'" is marked '+('as "'+p+'" and has same translation ')+"language as it already is.");var c=n.$nodeToReplace.prop("nodeName").toLowerCase();"#comment"===c?n.$textNodeToTranslate.after((0,u["default"])("<!--"+p+":"+s+"-->")):n.$textNodeToTranslate.after((0,u["default"])("<"+c+">"+p+":"+s+"</"+(c+">")).hide()),n.$textNodeToTranslate.after((0,u["default"])("<!--"+e+"-->")),"#text"===n.$textNodeToTranslate.prop("nodeName")?n.$textNodeToTranslate.prop("textContent",n.textToReplace):n.$textNodeToTranslate.html(n.textToReplace),d.remove(),n.$nodeToReplace.remove()}},o=this._replacements,a=Array.isArray(o),r=0,o=a?o:o[Symbol.iterator]();;){var i,s=n();if("break"===s)break}return u["default"].each(this._textNodesWithKnownTranslation,function(e,t){return t.prop("textContent",e)}),"localStorage"in l&&l.localStorage.setItem(this._options.sessionDescription,e),this.currentLanguage=e,this},t.prototype._switchCurrentLanguageIndicator=function(e){return(0,u["default"])('a[href="#'+this._options.languageHashPrefix+(this.currentLanguage+'"].')+this._options.currentLanguageIndicatorClassName).removeClass(this._options.currentLanguageIndicatorClassName),(0,u["default"])('a[href="#'+this._options.languageHashPrefix+e+'"]').addClass(this._options.currentLanguageIndicatorClassName),this},t}(u["default"].Tools["class"]);d._name="Lang",u["default"].Lang=function(){return u["default"].Tools().controller(d,arguments)},u["default"].Lang["class"]=d,t.exports=d}).call(t,function(){return this}(),n(2)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,n){t.exports=e},function(e,n){e.exports=t}])});