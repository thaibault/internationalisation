'use strict';
(function(m,n){'object'==typeof exports&&'object'==typeof module?module.exports=n(require('clientnode')):'function'==typeof define&&define.amd?define('internationalisation',['clientnode'],n):'object'==typeof exports?exports.internationalisation=n(require('clientnode')):m.internationalisation=n(m.clientnode)})(this,function(l){return function(m){function n(p){if(o[p])return o[p].exports;var q=o[p]={i:p,l:!1,exports:{}};return m[p].call(q.exports,q,q.exports,n),q.l=!0,q.exports}var o={};return n.m=m,n.c=o,n.i=function(p){return p},n.d=function(p,q,r){n.o(p,q)||Object.defineProperty(p,q,{configurable:!1,enumerable:!0,get:r})},n.n=function(p){var q=p&&p.__esModule?function(){return p['default']}:function(){return p};return n.d(q,'a',q),q},n.o=function(p,q){return Object.prototype.hasOwnProperty.call(p,q)},n.p='',n(n.s=3)}([function(m,n,o){'use strict';(function(p){'use strict';function q(u){return function(){var v=u.apply(this,arguments);return new Promise(function(w,x){function y(z,A){try{var B=v[z](A),C=B.value}catch(D){return void x(D)}return B.done?void w(C):Promise.resolve(C).then(function(D){y('next',D)},function(D){y('throw',D)})}return y('next')})}}n.__esModule=!0,n.$=void 0;var r=o(2);try{p.require('source-map-support/register')}catch(u){}var s=n.$=r.$;class t extends s.Tools.class{initialize(u={},v='',w={},x=null,y=[],z={}){var A=this;this.currentLanguage=v,this.knownTranslation=w,this._$domNodeToFade=x,this._replacements=y,this._textNodesWithKnownTranslation=z,this._options={domNodeSelectorPrefix:'body',default:'enUS',selection:[],initial:null,templateDelimiter:{pre:'{{',post:'}}'},fadeEffect:!0,textNodeParent:{showAnimation:[{opacity:1},{duration:'fast'}],hideAnimation:[{opacity:0},{duration:'fast'}]},preReplacementLanguagePattern:'^\\|({1})$',replacementLanguagePattern:'^([a-z]{2}[A-Z]{2}):((.|\\s)*)$',currentLanguagePattern:'^[a-z]{2}[A-Z]{2}$',replacementDomNodeName:['#comment','langreplacement'],replaceDomNodeNames:['#text','langreplace'],toolsLockDescription:'{1}Switch',languageHashPrefix:'language-',currentLanguageIndicatorClassName:'current',sessionDescription:'{1}',languageMapping:{deDE:['de','de_de','de-de','german','deutsch'],enUS:['en','en_us','en-us'],enEN:['en_en','en-en','english'],frFR:['fr','fr_fr','fr-fr','french']},onSwitched:this.constructor.noop,onEnsured:this.constructor.noop,onSwitch:this.constructor.noop,onEnsure:this.constructor.noop,domNode:{knownTranslation:'div.toc'}},super.initialize(u),this._options.preReplacementLanguagePattern=this.constructor.stringFormat(this._options.preReplacementLanguagePattern,this._options.replacementLanguagePattern.substr(1,this._options.replacementLanguagePattern.length-2)),this._options.toolsLockDescription=this.constructor.stringFormat(this._options.toolsLockDescription,this.constructor._name),this._options.sessionDescription=this.constructor.stringFormat(this._options.sessionDescription,this.constructor._name),this.$domNodes=this.grabDomNode(this._options.domNode),this.$domNodes.switchLanguageButtons=s(`a[href^="#${this._options.languageHashPrefix}"]`),this._movePreReplacementNodes(),this.currentLanguage=this._normalizeLanguage(this._options.default);var B=this._determineUsefulLanguage();return this.on(this.$domNodes.switchLanguageButtons,'click',function(C){return C.preventDefault(),A.switch(s(C.target).attr('href').substr(A._options.languageHashPrefix.length+1))}),this.currentLanguage===B?s.when(this._switchCurrentLanguageIndicator(B)):this.switch(B,!0)}switch(u,v=!1){var w=this;return!0!==u&&this._options.selection.length&&!this._options.selection.includes(u)?(this.debug('"{1}" isn\'t one of the allowed languages.',u),s.when(this)):this.acquireLock(this._options.toolsLockDescription,function(){if(!0===u?(v=!0,u=w.currentLanguage):u=w._normalizeLanguage(u),v&&u!==w._options.default||w.currentLanguage!==u){var x='Switch to';v&&(x='Ensure'),w.debug('{1} "{2}".',x,u),w._switchCurrentLanguageIndicator(u),w.fireEvent(v?'ensure':'switch',!0,w,w.currentLanguage,u),w._$domNodeToFade=null,w._replacements=[];var[y,z]=w._collectTextNodesToReplace(u,v);return w._ensureLastTextNodeHavingLanguageIndicator(y,z,v),w._handleSwitchEffect(u,v)}return w.debug('"{1}" is already current selected language.',u),w.releaseLock(w._options.toolsLockDescription),s.when(w)})}refresh(){return this._movePreReplacementNodes().switch(!0)}_handleSwitchEffect(u,v){var w=this;return q(function*(){var x=w.currentLanguage;return!v&&w._options.fadeEffect&&w._$domNodeToFade?(yield w._$domNodeToFade.animate(...w._options.textNodeParent.hideAnimation).promise(),w._switchLanguage(u),w._$domNodeToFade&&(yield w._$domNodeToFade.animate(...w._options.textNodeParent.showAnimation).promise(),yield w.fireEvent(v?'ensured':'switched',!0,w,x,u),w.releaseLock(w._options.toolsLockDescription)),w):(w._switchLanguage(u),yield w.fireEvent(v?'ensured':'switched',!0,w,x,u),w.releaseLock(w._options.toolsLockDescription),w)})()}_movePreReplacementNodes(){var u=this;return this.$domNodes.parent.find(':not(iframe)').contents().each(function(){var v=s(this),w=v.prop('nodeName').toLowerCase();if(u._options.replacementDomNodeName.includes(w)){['#comment','#text'].includes(w)||v.hide();var x=new RegExp(u._options.preReplacementLanguagePattern),y=v.prop('textContent').match(x);y&&y[0]&&function(){v.prop('textContent',v.prop('textContent').replace(x,y[1]));var z=!1;v.parent().contents().each(function(){return z&&s(this).Tools('text').trim()?(v.appendTo(this),!1):void(v[0]===this&&(z=!0))})}()}}),this}_collectTextNodesToReplace(u,v){var w=null,x=null,y=null,z=null;this.knownTranslation={};var A=this;return this.$domNodes.parent.find(':not(iframe)').contents().each(function(){var B=s(this),C=B.prop('nodeName').toLowerCase();if(A._options.replaceDomNodeNames.includes(C.toLowerCase()))B.Tools('text').trim()&&0===B.parents(A._options.replaceDomNodeNames.join()).length&&(z=A._ensureLastTextNodeHavingLanguageIndicator(y,z,v),w=B);else if(w){if(A._options.replacementDomNodeName.includes(C)){var D=B.prop('textContent');'#comment'!==C&&(D=B.html());var E=D.match(new RegExp(A._options.replacementLanguagePattern));return Array.isArray(E)&&E[1]===u?(A.knownTranslation[w.Tools('text').trim()]=E[2].trim(),A._registerTextNodeToChange(w,B,E,x),y=w,z=x,w=null,x=null):B.prop('textContent').match(new RegExp(A._options.currentLanguagePattern))&&(x=B),!0}y=null,z=null,w=null,x=null}}),this._registerKnownTextNodes(),[y,z]}_registerKnownTextNodes(){this._textNodesWithKnownTranslation={};var u=this;return this.$domNodes.knownTranslation.find(':not(iframe)').contents().each(function(){var v=s(this);!u._options.replaceDomNodeNames.includes(v.prop('nodeName').toLowerCase())&&v.Tools('text').trim()&&0===v.parents(u._options.replaceDomNodeNames.join()).length&&u.knownTranslation.hasOwnProperty(v.Tools('text').trim())&&(u._addTextNodeToFade(v),u._textNodesWithKnownTranslation[u.knownTranslation[v.prop('textContent').trim()]]=u._textNodesWithKnownTranslation.hasOwnProperty(u.knownTranslation[v.prop('textContent').trim()])?u._textNodesWithKnownTranslation[u.knownTranslation[v.prop('textContent').trim()]].add(v):v)}),this}_normalizeLanguage(u){for(var v in this._options.languageMapping)if(this._options.languageMapping.hasOwnProperty(v)&&(this._options.languageMapping[v].includes(v.toLowerCase())||this._options.languageMapping[v].push(v.toLowerCase()),this._options.languageMapping[v].includes(u.toLowerCase())))return v;return this._options.default}_determineUsefulLanguage(){var u=void 0;return this._options.initial?u=this._options.initial:'localStorage'in s.global&&s.global.localStorage.getItem(this._options.sessionDescription)?(u=s.global.localStorage.getItem(this._options.sessionDescription),this.debug('Determine "{1}", because of local storage information.',u)):'navigator'in s.global&&s.global.navigator.language?(u=s.global.navigator.language,this.debug('Determine "{1}", because of browser settings.',u)):(u=this._options.default,this.debug('Determine "{1}", because of default option.',u)),u=this._normalizeLanguage(u),this._options.selection.length&&!this._options.selection.includes(u)&&(this.debug('"{1}" isn\'t one of the allowed languages. Set language to "{2}".',u,this._options.selection[0]),u=this._options.selection[0]),'localStorage'in s.global&&s.global.localStorage.setItem(this._options.sessionDescription,u),u}_addTextNodeToFade(u){var v=u.parent();return this._$domNodeToFade=this._$domNodeToFade?this._$domNodeToFade.add(v):v,this}_registerTextNodeToChange(u,v,w,x){return this._addTextNodeToFade(u),v&&this._replacements.push({$textNodeToTranslate:u,$nodeToReplace:v,textToReplace:w[2],$currentLanguageDomNode:x}),this}_ensureLastTextNodeHavingLanguageIndicator(u,v,w){if(u&&!v){var x=this.currentLanguage;w&&(x=this._options.default),v=s(`<!--${x}-->`),u.after(v)}return v}_switchLanguage(u){var v=this,w=function(A){var B=A.$textNodeToTranslate.html();'#text'===A.$textNodeToTranslate.prop('nodeName')&&(B=A.$textNodeToTranslate.prop('textContent'));var C=B.trim();if(!v._options.templateDelimiter||!C.endsWith(v._options.templateDelimiter.post)&&v._options.templateDelimiter.post){var D=A.$currentLanguageDomNode;A.$currentLanguageDomNode||function(){D=s('body');var G=!1;A.$textNodeToTranslate.parent().contents().each(function(){return G?(A.$currentLanguageDomNode=D=s(this),!1):void(this===A.$textNodeToTranslate[0]&&(G=!0))})}();var E=D.prop('textContent');u===E&&v.warn(`Text node "${A.textToReplace}" is marked `+`as "${E}" and has same translation `+'language as it already is.');var F=A.$nodeToReplace.prop('nodeName').toLowerCase();'#comment'===F?A.$textNodeToTranslate.after(s(`<!--${E}:${B}-->`)):A.$textNodeToTranslate.after(s(`<${F}>${E}:${B}</`+`${F}>`).hide()),A.$textNodeToTranslate.after(s(`<!--${u}-->`)),'#text'===A.$textNodeToTranslate.prop('nodeName')?A.$textNodeToTranslate.prop('textContent',A.textToReplace):A.$textNodeToTranslate.html(A.textToReplace),D.remove(),A.$nodeToReplace.remove()}};for(var x of this._replacements)w(x);for(var y in this._textNodesWithKnownTranslation)this._textNodesWithKnownTranslation.hasOwnProperty(y)&&this._textNodesWithKnownTranslation[y].prop('textContent',y);return'localStorage'in s.global&&s.global.localStorage.setItem(this._options.sessionDescription,u),this.currentLanguage=u,this}_switchCurrentLanguageIndicator(u){return s(`a[href="#${this._options.languageHashPrefix}`+`${this.currentLanguage}"].`+this._options.currentLanguageIndicatorClassName).removeClass(this._options.currentLanguageIndicatorClassName),s(`a[href="#${this._options.languageHashPrefix}${u}"]`).addClass(this._options.currentLanguageIndicatorClassName),this}}n.default=t,t._name='Language',s.Language=function(...u){return s.Tools().controller(t,u)},s.Language.class=t}).call(n,o(1)(m))},function(m){m.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],!n.children&&(n.children=[]),Object.defineProperty(n,'loaded',{enumerable:!0,configurable:!1,get:function(){return n.l}}),Object.defineProperty(n,'id',{enumerable:!0,configurable:!1,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(m){m.exports=l},function(m,n,o){m.exports=o(0)}])});