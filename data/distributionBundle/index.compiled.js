'use strict';
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require('clientnode'),require("babel-runtime/core-js/get-iterator"),require("babel-runtime/core-js/object/get-prototype-of"),require("babel-runtime/helpers/classCallCheck"),require("babel-runtime/helpers/createClass"),require("babel-runtime/helpers/get"),require("babel-runtime/helpers/inherits"),require("babel-runtime/helpers/possibleConstructorReturn"),require("babel-runtime/helpers/slicedToArray")):"function"==typeof define&&define.amd?define("internationalisation",["$.Tools","babel-runtime/core-js/get-iterator","babel-runtime/core-js/object/get-prototype-of","babel-runtime/helpers/classCallCheck","babel-runtime/helpers/createClass","babel-runtime/helpers/get","babel-runtime/helpers/inherits","babel-runtime/helpers/possibleConstructorReturn","babel-runtime/helpers/slicedToArray"],t):"object"==typeof exports?exports.internationalisation=t(require('clientnode'),require("babel-runtime/core-js/get-iterator"),require("babel-runtime/core-js/object/get-prototype-of"),require("babel-runtime/helpers/classCallCheck"),require("babel-runtime/helpers/createClass"),require("babel-runtime/helpers/get"),require("babel-runtime/helpers/inherits"),require("babel-runtime/helpers/possibleConstructorReturn"),require("babel-runtime/helpers/slicedToArray")):e.internationalisation=t(e["$.Tools"],e["babel-runtime/core-js/get-iterator"],e["babel-runtime/core-js/object/get-prototype-of"],e["babel-runtime/helpers/classCallCheck"],e["babel-runtime/helpers/createClass"],e["babel-runtime/helpers/get"],e["babel-runtime/helpers/inherits"],e["babel-runtime/helpers/possibleConstructorReturn"],e["babel-runtime/helpers/slicedToArray"])}(this,function(e,t,n,o,a,r,i,s,l){return function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.$=void 0;var a=n(3),r=o(a),i=n(10),s=o(i),l=n(4),u=o(l),c=n(5),p=o(c),h=n(6),d=o(h),g=n(9),m=o(g),f=n(7),_=o(f),T=n(8),b=o(T),x=n(2),N=t.$=x.$,v=function(e){function t(){return(0,p["default"])(this,t),(0,m["default"])(this,(t.__proto__||(0,u["default"])(t)).apply(this,arguments))}return(0,b["default"])(t,e),(0,d["default"])(t,[{key:"initialize",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=arguments.length<=3||void 0===arguments[3]?null:arguments[3],r=this,i=arguments.length<=4||void 0===arguments[4]?[]:arguments[4],s=arguments.length<=5||void 0===arguments[5]?{}:arguments[5];this.currentLanguage=n,this.knownTranslation=o,this._$domNodeToFade=a,this._replacements=i,this._textNodesWithKnownTranslation=s,this._options={domNodeSelectorPrefix:"body","default":"enUS",selection:[],initial:null,templateDelimiter:{pre:"{{",post:"}}"},fadeEffect:!0,textNodeParent:{showAnimation:[{opacity:1},{duration:"fast"}],hideAnimation:[{opacity:0},{duration:"fast"}]},preReplacementLanguagePattern:"^\\|({1})$",replacementLanguagePattern:"^([a-z]{2}[A-Z]{2}):((.|\\s)*)$",currentLanguagePattern:"^[a-z]{2}[A-Z]{2}$",replacementDomNodeName:["#comment","langreplacement"],replaceDomNodeNames:["#text","langreplace"],toolsLockDescription:"{1}Switch",languageHashPrefix:"language-",currentLanguageIndicatorClassName:"current",sessionDescription:"{1}",languageMapping:{deDE:["de","de_de","de-de","german","deutsch"],enUS:["en","en_us","en-us"],enEN:["en_en","en-en","english"],frFR:["fr","fr_fr","fr-fr","french"]},onSwitched:this.constructor.noop,onEnsured:this.constructor.noop,onSwitch:this.constructor.noop,onEnsure:this.constructor.noop,domNode:{knownTranslation:"div.toc"}},(0,_["default"])(t.prototype.__proto__||(0,u["default"])(t.prototype),"initialize",this).call(this,e),this._options.preReplacementLanguagePattern=this.constructor.stringFormat(this._options.preReplacementLanguagePattern,this._options.replacementLanguagePattern.substr(1,this._options.replacementLanguagePattern.length-2)),this._options.toolsLockDescription=this.constructor.stringFormat(this._options.toolsLockDescription,this.constructor._name),this._options.sessionDescription=this.constructor.stringFormat(this._options.sessionDescription,this.constructor._name),this.$domNodes=this.grabDomNode(this._options.domNode),this.$domNodes.switchLanguageButtons=N('a[href^="#'+this._options.languageHashPrefix+'"]'),this._movePreReplacementNodes(),this.currentLanguage=this._normalizeLanguage(this._options["default"]);var l=this._determineUsefulLanguage();return this.on(this.$domNodes.switchLanguageButtons,"click",function(e){return e.preventDefault(),r["switch"](N(e.target).attr("href").substr(r._options.languageHashPrefix.length+1))}),this.currentLanguage===l?N.when(this._switchCurrentLanguageIndicator(l)):this["switch"](l,!0)}},{key:"switch",value:function(e){var t=this,n=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];if(e!==!0&&this._options.selection.length&&!this._options.selection.includes(e))return this.debug('"{1}" isn\'t one of the allowed languages.',e),N.when(this);var o=N.Deferred();return this.acquireLock(this._options.toolsLockDescription,function(){if(e===!0?(n=!0,e=t.currentLanguage):e=t._normalizeLanguage(e),n&&e!==t._options["default"]||t.currentLanguage!==e){var a="Switch to";n&&(a="Ensure"),t.debug('{1} "{2}".',a,e),t._switchCurrentLanguageIndicator(e),t.fireEvent(n?"ensure":"switch",!0,t,t.currentLanguage,e),t._$domNodeToFade=null,t._replacements=[];var r=t._collectTextNodesToReplace(e,n),i=(0,s["default"])(r,2),l=i[0],u=i[1];t._ensureLastTextNodeHavingLanguageIndicator(l,u,n),t._handleSwitchEffect(e,n).then(function(){return o.resolve(t)})}else t.debug('"{1}" is already current selected language.',e),t.releaseLock(t._options.toolsLockDescription),o.resolve(t)}),o}},{key:"refresh",value:function(){return this._movePreReplacementNodes()["switch"](!0)}},{key:"_movePreReplacementNodes",value:function(){var e=this;return this.$domNodes.parent.find(":not(iframe)").contents().each(function(){var t=N(this),n=t.prop("nodeName").toLowerCase();if(e._options.replacementDomNodeName.includes(n)){["#comment","#text"].includes(n)||t.hide();var o=new RegExp(e._options.preReplacementLanguagePattern),a=t.prop("textContent").match(o);a&&a[0]&&!function(){t.prop("textContent",t.prop("textContent").replace(o,a[1]));var e=!1;t.parent().contents().each(function(){return e&&N(this).Tools("getText").trim()?(t.appendTo(this),!1):void(t[0]===this&&(e=!0))})}()}}),this}},{key:"_collectTextNodesToReplace",value:function(e,t){var n=null,o=null,a=null,r=null;this.knownTranslation={};var i=this;return this.$domNodes.parent.find(":not(iframe)").contents().each(function(){var s=N(this),l=s.prop("nodeName").toLowerCase();if(i._options.replaceDomNodeNames.includes(l.toLowerCase()))s.Tools("getText").trim()&&0===s.parents(i._options.replaceDomNodeNames.join()).length&&(r=i._ensureLastTextNodeHavingLanguageIndicator(a,r,t),n=s);else if(n){if(i._options.replacementDomNodeName.includes(l)){var u=s.prop("textContent");"#comment"!==l&&(u=s.html());var c=u.match(new RegExp(i._options.replacementLanguagePattern));return Array.isArray(c)&&c[1]===e?(i.knownTranslation[n.Tools("getText").trim()]=c[2].trim(),i._registerTextNodeToChange(n,s,c,o),a=n,r=o,n=null,o=null):s.prop("textContent").match(new RegExp(i._options.currentLanguagePattern))&&(o=s),!0}a=null,r=null,n=null,o=null}}),this._registerKnownTextNodes(),[a,r]}},{key:"_registerKnownTextNodes",value:function(){this._textNodesWithKnownTranslation={};var e=this;return this.$domNodes.knownTranslation.find(":not(iframe)").contents().each(function(){var t=N(this);!e._options.replaceDomNodeNames.includes(t.prop("nodeName").toLowerCase())&&t.Tools("getText").trim()&&0===t.parents(e._options.replaceDomNodeNames.join()).length&&e.knownTranslation.hasOwnProperty(t.Tools("getText").trim())&&(e._addTextNodeToFade(t),e._textNodesWithKnownTranslation.hasOwnProperty(e.knownTranslation[t.prop("textContent").trim()])?e._textNodesWithKnownTranslation[e.knownTranslation[t.prop("textContent").trim()]]=e._textNodesWithKnownTranslation[e.knownTranslation[t.prop("textContent").trim()]].add(t):e._textNodesWithKnownTranslation[e.knownTranslation[t.prop("textContent").trim()]]=t)}),this}},{key:"_normalizeLanguage",value:function(e){for(var t in this._options.languageMapping)if(this._options.languageMapping.hasOwnProperty(t)&&(this._options.languageMapping[t].includes(t.toLowerCase())||this._options.languageMapping[t].push(t.toLowerCase()),this._options.languageMapping[t].includes(e.toLowerCase())))return t;return this._options["default"]}},{key:"_determineUsefulLanguage",value:function(){var e=void 0;return this._options.initial?e=this._options.initial:"localStorage"in N.global&&N.global.localStorage.getItem(this._options.sessionDescription)?(e=N.global.localStorage.getItem(this._options.sessionDescription),this.debug('Determine "{1}", because of local storage information.',e)):"navigator"in N.global&&N.global.navigator.language?(e=N.global.navigator.language,this.debug('Determine "{1}", because of browser settings.',e)):(e=this._options["default"],this.debug('Determine "{1}", because of default option.',e)),e=this._normalizeLanguage(e),this._options.selection.length&&!this._options.selection.includes(e)&&(this.debug('"{1}" isn\'t one of the allowed languages. Set language to "{2}".',e,this._options.selection[0]),e=this._options.selection[0]),"localStorage"in N.global&&N.global.localStorage.setItem(this._options.sessionDescription,e),e}},{key:"_handleSwitchEffect",value:function(e,t){var n=this,o=this.currentLanguage;return!t&&this._options.fadeEffect&&this._$domNodeToFade?this._$domNodeToFade.animate.apply(this._$domNodeToFade,this._options.textNodeParent.hideAnimation).promise().then(function(){return n._switchLanguage(e),n._$domNodeToFade?n._$domNodeToFade.animate.apply(n._$domNodeToFade,n._options.textNodeParent.showAnimation).promise().then(function(){return n.fireEvent(t?"ensured":"switched",!0,n,o,e),n.releaseLock(n._options.toolsLockDescription),N.when(n)}):N.when(n)}):(this._switchLanguage(e),this.fireEvent(t?"ensured":"switched",!0,this,o,e),this.releaseLock(this._options.toolsLockDescription),N.when(this))}},{key:"_addTextNodeToFade",value:function(e){var t=e.parent();return this._$domNodeToFade?this._$domNodeToFade=this._$domNodeToFade.add(t):this._$domNodeToFade=t,this}},{key:"_registerTextNodeToChange",value:function(e,t,n,o){return this._addTextNodeToFade(e),t&&this._replacements.push({$textNodeToTranslate:e,$nodeToReplace:t,textToReplace:n[2],$currentLanguageDomNode:o}),this}},{key:"_ensureLastTextNodeHavingLanguageIndicator",value:function(e,t,n){if(e&&!t){var o=this.currentLanguage;n&&(o=this._options["default"]),t=N("<!--"+o+"-->"),e.after(t)}return t}},{key:"_switchLanguage",value:function(e){var t=this,n=!0,o=!1,a=void 0;try{for(var i,s=function(){var n=i.value,o=n.$textNodeToTranslate.html();"#text"===n.$textNodeToTranslate.prop("nodeName")&&(o=n.$textNodeToTranslate.prop("textContent"));var a=o.trim();if(!t._options.templateDelimiter||!a.endsWith(t._options.templateDelimiter.post)&&t._options.templateDelimiter.post){var r=n.$currentLanguageDomNode;n.$currentLanguageDomNode||!function(){r=N("body");var e=!1;n.$textNodeToTranslate.parent().contents().each(function(){return e?(n.$currentLanguageDomNode=r=N(this),!1):void(this===n.$textNodeToTranslate[0]&&(e=!0))})}();var s=r.prop("textContent");e===s&&t.warn('Text node "'+n.textToReplace+'" is marked '+('as "'+s+'" and has same translation ')+"language as it already is.");var l=n.$nodeToReplace.prop("nodeName").toLowerCase();"#comment"===l?n.$textNodeToTranslate.after(N("<!--"+s+":"+o+"-->")):n.$textNodeToTranslate.after(N("<"+l+">"+s+":"+o+"</"+(l+">")).hide()),n.$textNodeToTranslate.after(N("<!--"+e+"-->")),"#text"===n.$textNodeToTranslate.prop("nodeName")?n.$textNodeToTranslate.prop("textContent",n.textToReplace):n.$textNodeToTranslate.html(n.textToReplace),r.remove(),n.$nodeToReplace.remove()}},l=(0,r["default"])(this._replacements);!(n=(i=l.next()).done);n=!0)s()}catch(u){o=!0,a=u}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw a}}for(var c in this._textNodesWithKnownTranslation)this._textNodesWithKnownTranslation.hasOwnProperty(c)&&this._textNodesWithKnownTranslation[c].prop("textContent",c);return"localStorage"in N.global&&N.global.localStorage.setItem(this._options.sessionDescription,e),this.currentLanguage=e,this}},{key:"_switchCurrentLanguageIndicator",value:function(e){return N('a[href="#'+this._options.languageHashPrefix+(this.currentLanguage+'"].')+this._options.currentLanguageIndicatorClassName).removeClass(this._options.currentLanguageIndicatorClassName),N('a[href="#'+this._options.languageHashPrefix+e+'"]').addClass(this._options.currentLanguageIndicatorClassName),this}}]),t}(N.Tools["class"]);v._name="Language",t["default"]=v,N.Language=function(){return N.Tools().controller(v,arguments)},N.Language["class"]=v},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t){e.exports=a},function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t){e.exports=s},function(e,t){e.exports=l}])});