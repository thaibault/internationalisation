'use strict';
(function(a,b){'object'==typeof exports&&'object'==typeof module?module.exports=b(require('clientnode')):'function'==typeof define&&define.amd?define('internationalisation',['clientnode'],b):'object'==typeof exports?exports.internationalisation=b(require('clientnode')):a.internationalisation=b(a.clientnode)})('undefined'==typeof self?this:self,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=0)}([function(a,b,c){a.exports=c(1)},function(a,b,c){'use strict';(function(a){function d(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d('next',a)},function(a){d('throw',a)})}return d('next')})}}function e(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function f(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function g(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}b.__esModule=!0,b.Language=b.$=void 0;var h=c(3);try{a.require('source-map-support/register')}catch(a){}var i=b.$=h.$,j=b.Language=function(a){function b(){return e(this,b),f(this,a.apply(this,arguments))}return g(b,a),b.prototype.initialize=function(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'',d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,f=this,g=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[],h=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{};this.currentLanguage=c,this.knownTranslation=d,this._$domNodeToFade=e,this._replacements=g,this._textNodesWithKnownTranslation=h,this._options={domNodeSelectorPrefix:'body',default:'enUS',selection:[],initial:null,templateDelimiter:{pre:'{{',post:'}}'},fadeEffect:!0,textNodeParent:{showAnimation:[{opacity:1},{duration:'fast'}],hideAnimation:[{opacity:0},{duration:'fast'}]},preReplacementLanguagePattern:'^\\|({1})$',replacementLanguagePattern:'^([a-z]{2}[A-Z]{2}):((.|\\s)*)$',currentLanguagePattern:'^[a-z]{2}[A-Z]{2}$',replacementDomNodeName:['#comment','langreplacement'],replaceDomNodeNames:['#text','langreplace'],toolsLockDescription:'{1}Switch',languageHashPrefix:'language-',currentLanguageIndicatorClassName:'current',sessionDescription:'{1}',languageMapping:{deDE:['de','de_de','de-de','german','deutsch'],enUS:['en','en_us','en-us'],enEN:['en_en','en-en','english'],frFR:['fr','fr_fr','fr-fr','french']},onSwitched:this.constructor.noop,onEnsured:this.constructor.noop,onSwitch:this.constructor.noop,onEnsure:this.constructor.noop,domNode:{knownTranslation:'div.toc'}},a.prototype.initialize.call(this,b),this._options.preReplacementLanguagePattern=this.constructor.stringFormat(this._options.preReplacementLanguagePattern,this._options.replacementLanguagePattern.substr(1,this._options.replacementLanguagePattern.length-2)),this._options.toolsLockDescription=this.constructor.stringFormat(this._options.toolsLockDescription,this.constructor.name),this._options.sessionDescription=this.constructor.stringFormat(this._options.sessionDescription,this.constructor.name),this.$domNodes=this.grabDomNode(this._options.domNode),this.$domNodes.switchLanguageButtons=i('a[href^="#'+this._options.languageHashPrefix+'"]'),this._movePreReplacementNodes(),this.currentLanguage=this._normalizeLanguage(this._options.default);var j=this._determineUsefulLanguage();return this.on(this.$domNodes.switchLanguageButtons,'click',function(a){return a.preventDefault(),f.switch(i(a.target).attr('href').substr(f._options.languageHashPrefix.length+1))}),this.currentLanguage===j?i.when(this._switchCurrentLanguageIndicator(j)):this.switch(j,!0)},b.prototype.switch=function(a){var b=this,c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return!0!==a&&this._options.selection.length&&!this._options.selection.includes(a)?(this.debug('"{1}" isn\'t one of the allowed languages.',a),i.when(this)):this.acquireLock(this._options.toolsLockDescription,function(){if(!0===a?(c=!0,a=b.currentLanguage):a=b._normalizeLanguage(a),c&&a!==b._options.default||b.currentLanguage!==a){var d='Switch to';c&&(d='Ensure'),b.debug('{1} "{2}".',d,a),b._switchCurrentLanguageIndicator(a),b.fireEvent(c?'ensure':'switch',!0,b,b.currentLanguage,a),b._$domNodeToFade=null,b._replacements=[];var e=b._collectTextNodesToReplace(a,c),f=e[0],g=e[1];return b._ensureLastTextNodeHavingLanguageIndicator(f,g,c),b._handleSwitchEffect(a,c)}return b.debug('"{1}" is already current selected language.',a),b.releaseLock(b._options.toolsLockDescription),i.when(b)})},b.prototype.refresh=function(){return this._movePreReplacementNodes().switch(!0)},b.prototype._handleSwitchEffect=function(){var a=d(regeneratorRuntime.mark(function a(b,c){var d,e,f;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d=this.currentLanguage,!(!c&&this._options.fadeEffect&&this._$domNodeToFade)){a.next=12;break}return a.next=4,(e=this._$domNodeToFade).animate.apply(e,this._options.textNodeParent.hideAnimation).promise();case 4:if(this._switchLanguage(b),!this._$domNodeToFade){a.next=11;break}return a.next=8,(f=this._$domNodeToFade).animate.apply(f,this._options.textNodeParent.showAnimation).promise();case 8:return a.next=10,this.fireEvent(c?'ensured':'switched',!0,this,d,b);case 10:this.releaseLock(this._options.toolsLockDescription);case 11:return a.abrupt('return',this);case 12:return this._switchLanguage(b),a.next=15,this.fireEvent(c?'ensured':'switched',!0,this,d,b);case 15:return this.releaseLock(this._options.toolsLockDescription),a.abrupt('return',this);case 17:case'end':return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),b.prototype._movePreReplacementNodes=function(){var a=this;return this.$domNodes.parent.find(':not(iframe)').contents().each(function(){var b=i(this),c=b.prop('nodeName').toLowerCase();if(a._options.replacementDomNodeName.includes(c)){['#comment','#text'].includes(c)||b.hide();var d=new RegExp(a._options.preReplacementLanguagePattern),e=b.prop('textContent').match(d);if(e&&e[0]){b.prop('textContent',b.prop('textContent').replace(d,e[1]));var f=!1;b.parent().contents().each(function(){return f&&i(this).Tools('text').trim()?(b.appendTo(this),!1):void(b[0]===this&&(f=!0))})}}}),this},b.prototype._collectTextNodesToReplace=function(a,b){var c=null,d=null,e=null,f=null;this.knownTranslation={};var g=this;return this.$domNodes.parent.find(':not(iframe)').contents().each(function(){var h=i(this),j=h.prop('nodeName').toLowerCase();if(g._options.replaceDomNodeNames.includes(j.toLowerCase()))h.Tools('text').trim()&&0===h.parents(g._options.replaceDomNodeNames.join()).length&&(f=g._ensureLastTextNodeHavingLanguageIndicator(e,f,b),c=h);else if(c){if(g._options.replacementDomNodeName.includes(j)){var k=h.prop('textContent');'#comment'!==j&&(k=h.html());var l=k.match(new RegExp(g._options.replacementLanguagePattern));return Array.isArray(l)&&l[1]===a?(g.knownTranslation[c.Tools('text').trim()]=l[2].trim(),g._registerTextNodeToChange(c,h,l,d),e=c,f=d,c=null,d=null):h.prop('textContent').match(new RegExp(g._options.currentLanguagePattern))&&(d=h),!0}e=null,f=null,c=null,d=null}}),this._registerKnownTextNodes(),[e,f]},b.prototype._registerKnownTextNodes=function(){this._textNodesWithKnownTranslation={};var a=this;return this.$domNodes.knownTranslation.find(':not(iframe)').contents().each(function(){var b=i(this);!a._options.replaceDomNodeNames.includes(b.prop('nodeName').toLowerCase())&&b.Tools('text').trim()&&0===b.parents(a._options.replaceDomNodeNames.join()).length&&a.knownTranslation.hasOwnProperty(b.Tools('text').trim())&&(a._addTextNodeToFade(b),a._textNodesWithKnownTranslation[a.knownTranslation[b.prop('textContent').trim()]]=a._textNodesWithKnownTranslation.hasOwnProperty(a.knownTranslation[b.prop('textContent').trim()])?a._textNodesWithKnownTranslation[a.knownTranslation[b.prop('textContent').trim()]].add(b):b)}),this},b.prototype._normalizeLanguage=function(a){for(var b in this._options.languageMapping)if(this._options.languageMapping.hasOwnProperty(b)&&(this._options.languageMapping[b].includes(b.toLowerCase())||this._options.languageMapping[b].push(b.toLowerCase()),this._options.languageMapping[b].includes(a.toLowerCase())))return b;return this._options.default},b.prototype._determineUsefulLanguage=function(){var a;return this._options.initial?a=this._options.initial:'localStorage'in i.global&&i.global.localStorage.getItem(this._options.sessionDescription)?(a=i.global.localStorage.getItem(this._options.sessionDescription),this.debug('Determine "{1}", because of local storage information.',a)):'navigator'in i.global&&i.global.navigator.language?(a=i.global.navigator.language,this.debug('Determine "{1}", because of browser settings.',a)):(a=this._options.default,this.debug('Determine "{1}", because of default option.',a)),a=this._normalizeLanguage(a),this._options.selection.length&&!this._options.selection.includes(a)&&(this.debug('"{1}" isn\'t one of the allowed languages. Set language to "{2}".',a,this._options.selection[0]),a=this._options.selection[0]),'localStorage'in i.global&&i.global.localStorage.setItem(this._options.sessionDescription,a),a},b.prototype._addTextNodeToFade=function(a){var b=a.parent();return this._$domNodeToFade=this._$domNodeToFade?this._$domNodeToFade.add(b):b,this},b.prototype._registerTextNodeToChange=function(a,b,c,d){return this._addTextNodeToFade(a),b&&this._replacements.push({$textNodeToTranslate:a,$nodeToReplace:b,textToReplace:c[2],$currentLanguageDomNode:d}),this},b.prototype._ensureLastTextNodeHavingLanguageIndicator=function(a,b,c){if(a&&!b){var d=this.currentLanguage;c&&(d=this._options.default),b=i('<!--'+d+'-->'),a.after(b)}return b},b.prototype._switchLanguage=function(a){for(var b=this,c=function(c){var d=c.$textNodeToTranslate.html();'#text'===c.$textNodeToTranslate.prop('nodeName')&&(d=c.$textNodeToTranslate.prop('textContent'));var e=d.trim();if(!b._options.templateDelimiter||!e.endsWith(b._options.templateDelimiter.post)&&b._options.templateDelimiter.post){var f=c.$currentLanguageDomNode;if(!c.$currentLanguageDomNode){f=i('body');var g=!1;c.$textNodeToTranslate.parent().contents().each(function(){return g?(c.$currentLanguageDomNode=f=i(this),!1):void(this===c.$textNodeToTranslate[0]&&(g=!0))})}var h=f.prop('textContent');a===h&&b.warn('Text node "'+c.textToReplace+'" is marked '+('as "'+h+'" and has same translation language as it already is.'));var j=c.$nodeToReplace.prop('nodeName').toLowerCase();'#comment'===j?c.$textNodeToTranslate.after(i('<!--'+h+':'+d+'-->')):c.$textNodeToTranslate.after(i('<'+j+'>'+h+':'+d+'</'+(j+'>')).hide()),c.$textNodeToTranslate.after(i('<!--'+a+'-->')),'#text'===c.$textNodeToTranslate.prop('nodeName')?c.$textNodeToTranslate.prop('textContent',c.textToReplace):c.$textNodeToTranslate.html(c.textToReplace),f.remove(),c.$nodeToReplace.remove()}},d=this._replacements,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;c(h)}for(var j in this._textNodesWithKnownTranslation)this._textNodesWithKnownTranslation.hasOwnProperty(j)&&this._textNodesWithKnownTranslation[j].prop('textContent',j);return'localStorage'in i.global&&i.global.localStorage.setItem(this._options.sessionDescription,a),this.currentLanguage=a,this},b.prototype._switchCurrentLanguageIndicator=function(a){return i('a[href="#'+this._options.languageHashPrefix+(this.currentLanguage+'"].')+this._options.currentLanguageIndicatorClassName).removeClass(this._options.currentLanguageIndicatorClassName),i('a[href="#'+this._options.languageHashPrefix+a+'"]').addClass(this._options.currentLanguageIndicatorClassName),this},b}(i.Tools.class);j._name='Language',b.default=j,i.Language=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i.Tools().controller(j,b)},i.Language.class=j}).call(b,c(2)(a))},function(a){a.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],!a.children&&(a.children=[]),Object.defineProperty(a,'loaded',{enumerable:!0,get:function(){return a.l}}),Object.defineProperty(a,'id',{enumerable:!0,get:function(){return a.i}}),a.webpackPolyfill=1),a}},function(b){b.exports=a}])});