'use strict';if(typeof module!=='undefined'&&module!==null&&eval('typeof require')!=='undefined'&&eval('require')!==null&&'main'in eval('require')&&eval('typeof require.main')!=='undefined'&&eval('require.main')!==null){var ORIGINAL_MAIN_MODULE=module;if(module!==eval('require.main')&&'paths'in module&&'paths'in eval('require.main')&&typeof __dirname!=='undefined'&&__dirname!==null)module.paths=eval('require.main.paths').concat(module.paths.filter(function(path){return eval('require.main.paths').includes(path)}))};if(typeof window==='undefined'||window===null)var window=(typeof global==='undefined'||global===null)?{}:global;!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("clientnode")):"function"==typeof define&&define.amd?define("index",["clientnode"],t):"object"==typeof exports?exports.index=t(require("clientnode")):e.index=t(e.clientnode)}(this,(function(e){return function(){"use strict";var t=[,function(t){t.exports=e}],n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,o),a.exports}o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return function(){o.r(r),o.d(r,{Internationalisation:function(){return u}});var e=o(1),t=o.n(e);function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function i(e,t,n,o,r,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){function a(e){i(l,o,r,a,s,"next",e)}function s(e){i(l,o,r,a,s,"throw",e)}var l=e.apply(t,n);a(void 0)}))}}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}var u=function(o){function r(){for(var t,n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=o.call.apply(o,[this].concat(r))||this).$domNodes=null,t.currentLanguage="enUS",t.knownTranslations={},t.lock=new e.Lock,t.options=null,t._$domNodeToFade=null,t._replacements=[],t._textNodesWithKnownTranslation={},t}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t)}(r,o);var a=r.prototype;return a.initialize=function(n){var a=this;void 0===n&&(n={}),o.prototype.initialize.call(this,t().extend(!0,{},r._defaultOptions,n)),this.options.preReplacementLanguagePattern=t().stringFormat(this.options.preReplacementLanguagePattern,this.options.replacementLanguagePattern.substr(1,this.options.replacementLanguagePattern.length-2)),this.options.lockDescription=t().stringFormat(this.options.lockDescription,this.options.name),this.options.sessionDescription=t().stringFormat(this.options.sessionDescription,this.options.name),this.$domNodes=this.grabDomNodes(this.options.domNodes,this.$domNode),this.$domNodes.switchLanguageButtons=(0,e.$)('a[href^="#'+this.options.languageHashPrefix+'"]'),this._movePreReplacementNodes(),this.currentLanguage=this._normalizeLanguage(this.options.default);var i=this._determineUsefulLanguage();return this.on(this.$domNodes.switchLanguageButtons,"click",(function(t){return t.preventDefault(),a.switch((0,e.$)(t.target).attr("href").substr(a.options.languageHashPrefix.length+1))})),this.currentLanguage===i?(this._switchCurrentLanguageIndicator(i),Promise.resolve(this.$domNode)):this.switch(i,!0)},a.switch=function(){var e=s(regeneratorRuntime.mark((function e(t,n){var o,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=!1),!0===t||!this.options.selection.length||this.options.selection.includes(t)){e.next=4;break}return this.debug('"{1}" isn\'t one of the allowed languages.',t),e.abrupt("return",this.$domNode);case 4:return e.next=6,this.lock.acquire(this.options.lockDescription);case 6:if(!0===t?(n=!0,t=this.currentLanguage):t=this._normalizeLanguage(t),!(n&&t!==this.options.default||this.currentLanguage!==t)){e.next=21;break}return o="Switch to",n&&(o="Ensure"),this.debug('{1} "{2}".',o,t),this._switchCurrentLanguageIndicator(t),e.next=14,this.fireEvent(n?"ensure":"switch",!0,this,this.currentLanguage,t);case 14:return this._$domNodeToFade=null,this._replacements=[],r=this._collectTextNodesToReplace(t,n),a=r[0],i=r[1],this._ensureLastTextNodeHavingLanguageIndicator(a,i,n),e.next=20,this._handleSwitchEffect(t,n);case 20:return e.abrupt("return",this.$domNode);case 21:return this.debug('"{1}" is already current selected language.',t),this.lock.release(this.options.lockDescription),e.abrupt("return",this.$domNode);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.refresh=function(){return this._movePreReplacementNodes(),this.switch(!0)},a._handleSwitchEffect=function(){var e=s(regeneratorRuntime.mark((function e(t,n){var o,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.currentLanguage,n||!this.options.fadeEffect||!this._$domNodeToFade){e.next=12;break}return e.next=4,(r=this._$domNodeToFade).animate.apply(r,this.options.textNodeParent.hideAnimation).promise();case 4:if(this._switchLanguage(t),!this._$domNodeToFade){e.next=11;break}return e.next=8,(a=this._$domNodeToFade).animate.apply(a,this.options.textNodeParent.showAnimation).promise();case 8:return e.next=10,this.fireEvent(n?"ensured":"switched",!0,this,o,t);case 10:this.lock.release(this.options.lockDescription);case 11:return e.abrupt("return");case 12:return this._switchLanguage(t),e.next=15,this.fireEvent(n?"ensured":"switched",!0,this,o,t);case 15:this.lock.release(this.options.lockDescription);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a._movePreReplacementNodes=function(){var t=this;this.$domNode.find(":not(iframe)").contents().each((function(){var n=(0,e.$)(this),o=n.prop("nodeName").toLowerCase();if(t.options.replacementDomNodeName.includes(o)){["#comment","#text"].includes(o)||n.hide();var r=new RegExp(t.options.preReplacementLanguagePattern),a=n.prop("textContent").match(r);if(a&&a[0]){n.prop("textContent",n.prop("textContent").replace(r,a[1]));var i=!1;n.parent().contents().each((function(){return i&&(0,e.$)(this).Tools("text").trim()?(n.appendTo(this),!1):void(n[0]===this&&(i=!0))}))}}}))},a._collectTextNodesToReplace=function(t,n){var o=null,r=null,a=null,i=null;this.knownTranslations={};var s=this;return this.$domNode.find(":not(iframe)").contents().each((function(){var l=(0,e.$)(this),u=l.prop("nodeName").toLowerCase();if(s.options.replaceDomNodeNames.includes(u.toLowerCase()))l.Tools("text").trim()&&0===l.parents(s.options.replaceDomNodeNames.join()).length&&(i=s._ensureLastTextNodeHavingLanguageIndicator(a,i,n),o=l);else if(o){if(s.options.replacementDomNodeName.includes(u)){var c=l.prop("textContent");"#comment"!==u&&(c=l.html());var d=c.match(new RegExp(s.options.replacementLanguagePattern));return void(Array.isArray(d)&&d[1]===t?(s.knownTranslations[o.Tools("text").trim()]=d[2].trim(),s._registerTextNodeToChange(o,l,d,r),a=o,i=r,o=null,r=null):l.prop("textContent").match(new RegExp(s.options.currentLanguagePattern))&&(r=l))}a=null,i=null,o=null,r=null}})),this._registerKnownTextNodes(),[a,i]},a._registerKnownTextNodes=function(){this._textNodesWithKnownTranslation={};var t=this;this.$domNodes.knownTranslation.find(":not(iframe)").contents().each((function(){var n=(0,e.$)(this);!t.options.replaceDomNodeNames.includes(n.prop("nodeName").toLowerCase())&&n.Tools("text").trim()&&0===n.parents(t.options.replaceDomNodeNames.join()).length&&Object.prototype.hasOwnProperty.call(t.knownTranslations,n.Tools("text").trim())&&(t._addTextNodeToFade(n),t._textNodesWithKnownTranslation[t.knownTranslations[n.prop("textContent").trim()]]=Object.prototype.hasOwnProperty.call(t._textNodesWithKnownTranslation,t.knownTranslations[n.prop("textContent").trim()])?t._textNodesWithKnownTranslation[t.knownTranslations[n.prop("textContent").trim()]].add(this):n)}))},a._normalizeLanguage=function(e){for(var t=0,n=Object.entries(this.options.languageMapping);t<n.length;t++){var o=n[t],r=o[0],a=o[1];if(a.includes(r.toLowerCase())||a.push(r.toLowerCase()),a.includes(e.toLowerCase()))return r}return this.options.default},a._determineUsefulLanguage=function(){var t,n,o,r;return this.options.initial?r=this.options.initial:e.$.global.window&&(null!=(t=e.$.global.window.localStorage)&&t.getItem(this.options.sessionDescription)?(r=e.$.global.window.localStorage.getItem(this.options.sessionDescription),this.debug('Determine "'+r+'", because of local storage information.')):null!=(n=e.$.global.window.navigator)&&n.language&&(r=e.$.global.window.navigator.language,this.debug('Determine "'+r+'", because of browser settings.'))),r||(r=this.options.default,this.debug('Determine "'+r+'", because of default option.')),r=this._normalizeLanguage(r),this.options.selection.length&&!this.options.selection.includes(r)&&(this.debug('"'+r+'" isn\'t one of the allowed languages. Set language to "'+this.options.selection[0]+'".'),r=this.options.selection[0]),null!=(o=e.$.global.window)&&o.localStorage&&e.$.global.window.localStorage.setItem(this.options.sessionDescription,r),r},a._addTextNodeToFade=function(e){var t=e.parent();this._$domNodeToFade=this._$domNodeToFade?this._$domNodeToFade.add(t):t},a._registerTextNodeToChange=function(e,t,n,o){this._addTextNodeToFade(e),t&&this._replacements.push({$textNodeToTranslate:e,$nodeToReplace:t,textToReplace:n[2],$currentLanguageDomNode:o})},a._ensureLastTextNodeHavingLanguageIndicator=function(t,n,o){if(t&&!n){var r=this.currentLanguage;o&&(r=this.options.default),n=(0,e.$)("\x3c!--"+r+"--\x3e"),t.after(n)}return n},a._switchLanguage=function(t){for(var o,r=this,a=function(){var n=o.value,a=n.$textNodeToTranslate.html();"#text"===n.$textNodeToTranslate.prop("nodeName")&&(a=n.$textNodeToTranslate.prop("textContent"));var i=a.trim();if(!r.options.templateDelimiter||!i.endsWith(r.options.templateDelimiter.post)&&r.options.templateDelimiter.post){var s=n.$currentLanguageDomNode;if(!s){s=(0,e.$)("body");var l=!1;n.$textNodeToTranslate.parent().contents().each((function(){return l?(n.$currentLanguageDomNode=s=(0,e.$)(this),!1):void(this===n.$textNodeToTranslate[0]&&(l=!0))}))}var u=s.prop("textContent");t===u&&r.warn('Text node "'+n.textToReplace+'" is marked as "'+u+'" and has same translation language as it already is.');var c=n.$nodeToReplace.prop("nodeName").toLowerCase();"#comment"===c?n.$textNodeToTranslate.after((0,e.$)("\x3c!--"+u+":"+a+"--\x3e")):n.$textNodeToTranslate.after((0,e.$)("<"+c+">"+u+":"+a+"</"+c+">").hide()),n.$textNodeToTranslate.after((0,e.$)("\x3c!--"+t+"--\x3e")),"#text"===n.$textNodeToTranslate.prop("nodeName")?n.$textNodeToTranslate.prop("textContent",n.textToReplace):n.$textNodeToTranslate.html(n.textToReplace),s.remove(),n.$nodeToReplace.remove()}},i=n(this._replacements);!(o=i()).done;)a();for(var s=0,l=Object.entries(this._textNodesWithKnownTranslation);s<l.length;s++){var u=l[s],c=u[0];u[1].prop("textContent",c)}"localStorage"in e.$.global&&e.$.global.localStorage.setItem(this.options.sessionDescription,t),this.currentLanguage=t},a._switchCurrentLanguageIndicator=function(t){(0,e.$)('a[href="#'+this.options.languageHashPrefix+this.currentLanguage+'"].'+this.options.currentLanguageIndicatorClassName).removeClass(this.options.currentLanguageIndicatorClassName),(0,e.$)('a[href="#'+this.options.languageHashPrefix+t+'"]').addClass(this.options.currentLanguageIndicatorClassName)},r}(e.BoundTools);u._defaultOptions={currentLanguageIndicatorClassName:"current",currentLanguagePattern:"^[a-z]{2}[A-Z]{2}$",default:"enUS",domNodes:{knownTranslation:"div.toc"},fadeEffect:!0,initial:null,languageHashPrefix:"lang-",languageMapping:{deDE:["de","de_de","de-de","german","deutsch"],enUS:["en","en_us","en-us"],enEN:["en_en","en-en","english"],frFR:["fr","fr_fr","fr-fr","french"]},lockDescription:"{1}Switch",name:"Internationalisation",onSwitched:t().noop,onEnsured:t().noop,onSwitch:t().noop,onEnsure:t().noop,preReplacementLanguagePattern:"^\\|({1})$",replaceDomNodeNames:["#text","lang-replace"],replacementDomNodeName:["#comment","lang-replacement"],replacementLanguagePattern:"^([a-z]{2}[A-Z]{2}):((.|\\s)*)$",selection:[],sessionDescription:"{1}",templateDelimiter:{pre:"{{",post:"}}"},textNodeParent:{hideAnimation:[{opacity:0},{duration:"fast"}],showAnimation:[{opacity:1},{duration:"fast"}]}},r.default=u,e.$.fn&&(e.$.fn.Internationalisation=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t().controller(u,n,this)})}(),r}()}));